{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar core = require('@vueuse/core');\nvar lodashUnified = require('lodash-unified');\nrequire('../../../hooks/index.js');\nrequire('../../../constants/index.js');\nrequire('../../../utils/index.js');\nvar index$3 = require('../../icon/index.js');\nvar iconsVue = require('@element-plus/icons-vue');\nvar imageViewer = require('./image-viewer.js');\nvar pluginVue_exportHelper = require('../../../_virtual/plugin-vue_export-helper.js');\nvar index = require('../../../hooks/use-locale/index.js');\nvar index$1 = require('../../../hooks/use-namespace/index.js');\nvar index$2 = require('../../../hooks/use-z-index/index.js');\nvar aria = require('../../../constants/aria.js');\nvar objects = require('../../../utils/objects.js');\nconst _hoisted_1 = [\"src\", \"crossorigin\"];\nconst __default__ = vue.defineComponent({\n  name: \"ElImageViewer\"\n});\nconst _sfc_main = /* @__PURE__ */vue.defineComponent({\n  ...__default__,\n  props: imageViewer.imageViewerProps,\n  emits: imageViewer.imageViewerEmits,\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    var _a;\n    const props = __props;\n    const modes = {\n      CONTAIN: {\n        name: \"contain\",\n        icon: vue.markRaw(iconsVue.FullScreen)\n      },\n      ORIGINAL: {\n        name: \"original\",\n        icon: vue.markRaw(iconsVue.ScaleToOriginal)\n      }\n    };\n    const {\n      t\n    } = index.useLocale();\n    const ns = index$1.useNamespace(\"image-viewer\");\n    const {\n      nextZIndex\n    } = index$2.useZIndex();\n    const wrapper = vue.ref();\n    const imgRefs = vue.ref([]);\n    const scopeEventListener = vue.effectScope();\n    const loading = vue.ref(true);\n    const activeIndex = vue.ref(props.initialIndex);\n    const mode = vue.shallowRef(modes.CONTAIN);\n    const transform = vue.ref({\n      scale: 1,\n      deg: 0,\n      offsetX: 0,\n      offsetY: 0,\n      enableTransition: false\n    });\n    const zIndex = vue.ref((_a = props.zIndex) != null ? _a : nextZIndex());\n    const isSingle = vue.computed(() => {\n      const {\n        urlList\n      } = props;\n      return urlList.length <= 1;\n    });\n    const isFirst = vue.computed(() => {\n      return activeIndex.value === 0;\n    });\n    const isLast = vue.computed(() => {\n      return activeIndex.value === props.urlList.length - 1;\n    });\n    const currentImg = vue.computed(() => {\n      return props.urlList[activeIndex.value];\n    });\n    const arrowPrevKls = vue.computed(() => [ns.e(\"btn\"), ns.e(\"prev\"), ns.is(\"disabled\", !props.infinite && isFirst.value)]);\n    const arrowNextKls = vue.computed(() => [ns.e(\"btn\"), ns.e(\"next\"), ns.is(\"disabled\", !props.infinite && isLast.value)]);\n    const imgStyle = vue.computed(() => {\n      const {\n        scale,\n        deg,\n        offsetX,\n        offsetY,\n        enableTransition\n      } = transform.value;\n      let translateX = offsetX / scale;\n      let translateY = offsetY / scale;\n      switch (deg % 360) {\n        case 90:\n        case -270:\n          ;\n          [translateX, translateY] = [translateY, -translateX];\n          break;\n        case 180:\n        case -180:\n          ;\n          [translateX, translateY] = [-translateX, -translateY];\n          break;\n        case 270:\n        case -90:\n          ;\n          [translateX, translateY] = [-translateY, translateX];\n          break;\n      }\n      const style = {\n        transform: `scale(${scale}) rotate(${deg}deg) translate(${translateX}px, ${translateY}px)`,\n        transition: enableTransition ? \"transform .3s\" : \"\"\n      };\n      if (mode.value.name === modes.CONTAIN.name) {\n        style.maxWidth = style.maxHeight = \"100%\";\n      }\n      return style;\n    });\n    function hide() {\n      unregisterEventListener();\n      emit(\"close\");\n    }\n    function registerEventListener() {\n      const keydownHandler = lodashUnified.throttle(e => {\n        switch (e.code) {\n          case aria.EVENT_CODE.esc:\n            props.closeOnPressEscape && hide();\n            break;\n          case aria.EVENT_CODE.space:\n            toggleMode();\n            break;\n          case aria.EVENT_CODE.left:\n            prev();\n            break;\n          case aria.EVENT_CODE.up:\n            handleActions(\"zoomIn\");\n            break;\n          case aria.EVENT_CODE.right:\n            next();\n            break;\n          case aria.EVENT_CODE.down:\n            handleActions(\"zoomOut\");\n            break;\n        }\n      });\n      const mousewheelHandler = lodashUnified.throttle(e => {\n        const delta = e.deltaY || e.deltaX;\n        handleActions(delta < 0 ? \"zoomIn\" : \"zoomOut\", {\n          zoomRate: props.zoomRate,\n          enableTransition: false\n        });\n      });\n      scopeEventListener.run(() => {\n        core.useEventListener(document, \"keydown\", keydownHandler);\n        core.useEventListener(document, \"wheel\", mousewheelHandler);\n      });\n    }\n    function unregisterEventListener() {\n      scopeEventListener.stop();\n    }\n    function handleImgLoad() {\n      loading.value = false;\n    }\n    function handleImgError(e) {\n      loading.value = false;\n      e.target.alt = t(\"el.image.error\");\n    }\n    function handleMouseDown(e) {\n      if (loading.value || e.button !== 0 || !wrapper.value) return;\n      transform.value.enableTransition = false;\n      const {\n        offsetX,\n        offsetY\n      } = transform.value;\n      const startX = e.pageX;\n      const startY = e.pageY;\n      const dragHandler = lodashUnified.throttle(ev => {\n        transform.value = {\n          ...transform.value,\n          offsetX: offsetX + ev.pageX - startX,\n          offsetY: offsetY + ev.pageY - startY\n        };\n      });\n      const removeMousemove = core.useEventListener(document, \"mousemove\", dragHandler);\n      core.useEventListener(document, \"mouseup\", () => {\n        removeMousemove();\n      });\n      e.preventDefault();\n    }\n    function reset() {\n      transform.value = {\n        scale: 1,\n        deg: 0,\n        offsetX: 0,\n        offsetY: 0,\n        enableTransition: false\n      };\n    }\n    function toggleMode() {\n      if (loading.value) return;\n      const modeNames = objects.keysOf(modes);\n      const modeValues = Object.values(modes);\n      const currentMode = mode.value.name;\n      const index = modeValues.findIndex(i => i.name === currentMode);\n      const nextIndex = (index + 1) % modeNames.length;\n      mode.value = modes[modeNames[nextIndex]];\n      reset();\n    }\n    function setActiveItem(index) {\n      const len = props.urlList.length;\n      activeIndex.value = (index + len) % len;\n    }\n    function prev() {\n      if (isFirst.value && !props.infinite) return;\n      setActiveItem(activeIndex.value - 1);\n    }\n    function next() {\n      if (isLast.value && !props.infinite) return;\n      setActiveItem(activeIndex.value + 1);\n    }\n    function handleActions(action, options = {}) {\n      if (loading.value) return;\n      const {\n        minScale,\n        maxScale\n      } = props;\n      const {\n        zoomRate,\n        rotateDeg,\n        enableTransition\n      } = {\n        zoomRate: props.zoomRate,\n        rotateDeg: 90,\n        enableTransition: true,\n        ...options\n      };\n      switch (action) {\n        case \"zoomOut\":\n          if (transform.value.scale > minScale) {\n            transform.value.scale = Number.parseFloat((transform.value.scale / zoomRate).toFixed(3));\n          }\n          break;\n        case \"zoomIn\":\n          if (transform.value.scale < maxScale) {\n            transform.value.scale = Number.parseFloat((transform.value.scale * zoomRate).toFixed(3));\n          }\n          break;\n        case \"clockwise\":\n          transform.value.deg += rotateDeg;\n          emit(\"rotate\", transform.value.deg);\n          break;\n        case \"anticlockwise\":\n          transform.value.deg -= rotateDeg;\n          emit(\"rotate\", transform.value.deg);\n          break;\n      }\n      transform.value.enableTransition = enableTransition;\n    }\n    vue.watch(currentImg, () => {\n      vue.nextTick(() => {\n        const $img = imgRefs.value[0];\n        if (!($img == null ? void 0 : $img.complete)) {\n          loading.value = true;\n        }\n      });\n    });\n    vue.watch(activeIndex, val => {\n      reset();\n      emit(\"switch\", val);\n    });\n    vue.onMounted(() => {\n      var _a2, _b;\n      registerEventListener();\n      (_b = (_a2 = wrapper.value) == null ? void 0 : _a2.focus) == null ? void 0 : _b.call(_a2);\n    });\n    expose({\n      setActiveItem\n    });\n    return (_ctx, _cache) => {\n      return vue.openBlock(), vue.createBlock(vue.Teleport, {\n        to: \"body\",\n        disabled: !_ctx.teleported\n      }, [vue.createVNode(vue.Transition, {\n        name: \"viewer-fade\",\n        appear: \"\"\n      }, {\n        default: vue.withCtx(() => [vue.createElementVNode(\"div\", {\n          ref_key: \"wrapper\",\n          ref: wrapper,\n          tabindex: -1,\n          class: vue.normalizeClass(vue.unref(ns).e(\"wrapper\")),\n          style: vue.normalizeStyle({\n            zIndex: zIndex.value\n          })\n        }, [vue.createElementVNode(\"div\", {\n          class: vue.normalizeClass(vue.unref(ns).e(\"mask\")),\n          onClick: _cache[0] || (_cache[0] = vue.withModifiers($event => _ctx.hideOnClickModal && hide(), [\"self\"]))\n        }, null, 2), vue.createCommentVNode(\" CLOSE \"), vue.createElementVNode(\"span\", {\n          class: vue.normalizeClass([vue.unref(ns).e(\"btn\"), vue.unref(ns).e(\"close\")]),\n          onClick: hide\n        }, [vue.createVNode(vue.unref(index$3.ElIcon), null, {\n          default: vue.withCtx(() => [vue.createVNode(vue.unref(iconsVue.Close))]),\n          _: 1\n        })], 2), vue.createCommentVNode(\" ARROW \"), !vue.unref(isSingle) ? (vue.openBlock(), vue.createElementBlock(vue.Fragment, {\n          key: 0\n        }, [vue.createElementVNode(\"span\", {\n          class: vue.normalizeClass(vue.unref(arrowPrevKls)),\n          onClick: prev\n        }, [vue.createVNode(vue.unref(index$3.ElIcon), null, {\n          default: vue.withCtx(() => [vue.createVNode(vue.unref(iconsVue.ArrowLeft))]),\n          _: 1\n        })], 2), vue.createElementVNode(\"span\", {\n          class: vue.normalizeClass(vue.unref(arrowNextKls)),\n          onClick: next\n        }, [vue.createVNode(vue.unref(index$3.ElIcon), null, {\n          default: vue.withCtx(() => [vue.createVNode(vue.unref(iconsVue.ArrowRight))]),\n          _: 1\n        })], 2)], 64)) : vue.createCommentVNode(\"v-if\", true), vue.createCommentVNode(\" ACTIONS \"), vue.createElementVNode(\"div\", {\n          class: vue.normalizeClass([vue.unref(ns).e(\"btn\"), vue.unref(ns).e(\"actions\")])\n        }, [vue.createElementVNode(\"div\", {\n          class: vue.normalizeClass(vue.unref(ns).e(\"actions__inner\"))\n        }, [vue.createVNode(vue.unref(index$3.ElIcon), {\n          onClick: _cache[1] || (_cache[1] = $event => handleActions(\"zoomOut\"))\n        }, {\n          default: vue.withCtx(() => [vue.createVNode(vue.unref(iconsVue.ZoomOut))]),\n          _: 1\n        }), vue.createVNode(vue.unref(index$3.ElIcon), {\n          onClick: _cache[2] || (_cache[2] = $event => handleActions(\"zoomIn\"))\n        }, {\n          default: vue.withCtx(() => [vue.createVNode(vue.unref(iconsVue.ZoomIn))]),\n          _: 1\n        }), vue.createElementVNode(\"i\", {\n          class: vue.normalizeClass(vue.unref(ns).e(\"actions__divider\"))\n        }, null, 2), vue.createVNode(vue.unref(index$3.ElIcon), {\n          onClick: toggleMode\n        }, {\n          default: vue.withCtx(() => [(vue.openBlock(), vue.createBlock(vue.resolveDynamicComponent(vue.unref(mode).icon)))]),\n          _: 1\n        }), vue.createElementVNode(\"i\", {\n          class: vue.normalizeClass(vue.unref(ns).e(\"actions__divider\"))\n        }, null, 2), vue.createVNode(vue.unref(index$3.ElIcon), {\n          onClick: _cache[3] || (_cache[3] = $event => handleActions(\"anticlockwise\"))\n        }, {\n          default: vue.withCtx(() => [vue.createVNode(vue.unref(iconsVue.RefreshLeft))]),\n          _: 1\n        }), vue.createVNode(vue.unref(index$3.ElIcon), {\n          onClick: _cache[4] || (_cache[4] = $event => handleActions(\"clockwise\"))\n        }, {\n          default: vue.withCtx(() => [vue.createVNode(vue.unref(iconsVue.RefreshRight))]),\n          _: 1\n        })], 2)], 2), vue.createCommentVNode(\" CANVAS \"), vue.createElementVNode(\"div\", {\n          class: vue.normalizeClass(vue.unref(ns).e(\"canvas\"))\n        }, [(vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(_ctx.urlList, (url, i) => {\n          return vue.withDirectives((vue.openBlock(), vue.createElementBlock(\"img\", {\n            ref_for: true,\n            ref: el => imgRefs.value[i] = el,\n            key: url,\n            src: url,\n            style: vue.normalizeStyle(vue.unref(imgStyle)),\n            class: vue.normalizeClass(vue.unref(ns).e(\"img\")),\n            crossorigin: _ctx.crossorigin,\n            onLoad: handleImgLoad,\n            onError: handleImgError,\n            onMousedown: handleMouseDown\n          }, null, 46, _hoisted_1)), [[vue.vShow, i === activeIndex.value]]);\n        }), 128))], 2), vue.renderSlot(_ctx.$slots, \"default\")], 6)]),\n        _: 3\n      })], 8, [\"disabled\"]);\n    };\n  }\n});\nvar ImageViewer = /* @__PURE__ */pluginVue_exportHelper[\"default\"](_sfc_main, [[\"__file\", \"image-viewer.vue\"]]);\nexports[\"default\"] = ImageViewer;","map":{"version":3,"names":["name","props","__props","modes","CONTAIN","icon","vue","markRaw","iconsVue","FullScreen","ORIGINAL","ScaleToOriginal","t","index","useLocale","ns","index$1","useNamespace","nextZIndex","index$2","useZIndex","wrapper","ref","imgRefs","scopeEventListener","effectScope","loading","activeIndex","initialIndex","mode","shallowRef","transform","scale","deg","offsetX","offsetY","enableTransition","zIndex","_a","isSingle","computed","urlList","length","isFirst","value","isLast","currentImg","arrowPrevKls","e","is","infinite","arrowNextKls","imgStyle","translateX","translateY","style","transition","maxWidth","maxHeight","hide","unregisterEventListener","emit","registerEventListener","keydownHandler","lodashUnified","throttle","code","aria","EVENT_CODE","esc","closeOnPressEscape","space","toggleMode","left","prev","up","handleActions","right","next","down","mousewheelHandler","delta","deltaY","deltaX","zoomRate","run","core","useEventListener","document","stop","handleImgLoad","handleImgError","target","alt","handleMouseDown","button","startX","pageX","startY","pageY","dragHandler","ev","removeMousemove","preventDefault","reset","modeNames","objects","keysOf","modeValues","Object","values","currentMode","findIndex","i","nextIndex","setActiveItem","len","action","options","minScale","maxScale","rotateDeg","Number","parseFloat","toFixed","watch","nextTick","$img","complete","val","onMounted","_a2","_b","focus","call","expose"],"sources":["../../../../../../packages/components/image-viewer/src/image-viewer.vue"],"sourcesContent":["<template>\n  <teleport to=\"body\" :disabled=\"!teleported\">\n    <transition name=\"viewer-fade\" appear>\n      <div\n        ref=\"wrapper\"\n        :tabindex=\"-1\"\n        :class=\"ns.e('wrapper')\"\n        :style=\"{ zIndex }\"\n      >\n        <div :class=\"ns.e('mask')\" @click.self=\"hideOnClickModal && hide()\" />\n\n        <!-- CLOSE -->\n        <span :class=\"[ns.e('btn'), ns.e('close')]\" @click=\"hide\">\n          <el-icon><Close /></el-icon>\n        </span>\n\n        <!-- ARROW -->\n        <template v-if=\"!isSingle\">\n          <span :class=\"arrowPrevKls\" @click=\"prev\">\n            <el-icon><ArrowLeft /></el-icon>\n          </span>\n          <span :class=\"arrowNextKls\" @click=\"next\">\n            <el-icon><ArrowRight /></el-icon>\n          </span>\n        </template>\n        <!-- ACTIONS -->\n        <div :class=\"[ns.e('btn'), ns.e('actions')]\">\n          <div :class=\"ns.e('actions__inner')\">\n            <el-icon @click=\"handleActions('zoomOut')\">\n              <ZoomOut />\n            </el-icon>\n            <el-icon @click=\"handleActions('zoomIn')\">\n              <ZoomIn />\n            </el-icon>\n            <i :class=\"ns.e('actions__divider')\" />\n            <el-icon @click=\"toggleMode\">\n              <component :is=\"mode.icon\" />\n            </el-icon>\n            <i :class=\"ns.e('actions__divider')\" />\n            <el-icon @click=\"handleActions('anticlockwise')\">\n              <RefreshLeft />\n            </el-icon>\n            <el-icon @click=\"handleActions('clockwise')\">\n              <RefreshRight />\n            </el-icon>\n          </div>\n        </div>\n        <!-- CANVAS -->\n        <div :class=\"ns.e('canvas')\">\n          <img\n            v-for=\"(url, i) in urlList\"\n            v-show=\"i === activeIndex\"\n            :ref=\"(el) => (imgRefs[i] = el as HTMLImageElement)\"\n            :key=\"url\"\n            :src=\"url\"\n            :style=\"imgStyle\"\n            :class=\"ns.e('img')\"\n            :crossorigin=\"crossorigin\"\n            @load=\"handleImgLoad\"\n            @error=\"handleImgError\"\n            @mousedown=\"handleMouseDown\"\n          />\n        </div>\n        <slot />\n      </div>\n    </transition>\n  </teleport>\n</template>\n\n<script lang=\"ts\" setup>\nimport {\n  computed,\n  effectScope,\n  markRaw,\n  nextTick,\n  onMounted,\n  ref,\n  shallowRef,\n  watch,\n} from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { throttle } from 'lodash-unified'\nimport { useLocale, useNamespace, useZIndex } from '@element-plus/hooks'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { keysOf } from '@element-plus/utils'\nimport ElIcon from '@element-plus/components/icon'\nimport {\n  ArrowLeft,\n  ArrowRight,\n  Close,\n  FullScreen,\n  RefreshLeft,\n  RefreshRight,\n  ScaleToOriginal,\n  ZoomIn,\n  ZoomOut,\n} from '@element-plus/icons-vue'\nimport { imageViewerEmits, imageViewerProps } from './image-viewer'\n\nimport type { CSSProperties } from 'vue'\nimport type { ImageViewerAction, ImageViewerMode } from './image-viewer'\n\nconst modes: Record<'CONTAIN' | 'ORIGINAL', ImageViewerMode> = {\n  CONTAIN: {\n    name: 'contain',\n    icon: markRaw(FullScreen),\n  },\n  ORIGINAL: {\n    name: 'original',\n    icon: markRaw(ScaleToOriginal),\n  },\n}\n\ndefineOptions({\n  name: 'ElImageViewer',\n})\n\nconst props = defineProps(imageViewerProps)\nconst emit = defineEmits(imageViewerEmits)\n\nconst { t } = useLocale()\nconst ns = useNamespace('image-viewer')\nconst { nextZIndex } = useZIndex()\nconst wrapper = ref<HTMLDivElement>()\nconst imgRefs = ref<HTMLImageElement[]>([])\n\nconst scopeEventListener = effectScope()\n\nconst loading = ref(true)\nconst activeIndex = ref(props.initialIndex)\nconst mode = shallowRef<ImageViewerMode>(modes.CONTAIN)\nconst transform = ref({\n  scale: 1,\n  deg: 0,\n  offsetX: 0,\n  offsetY: 0,\n  enableTransition: false,\n})\nconst zIndex = ref(props.zIndex ?? nextZIndex())\n\nconst isSingle = computed(() => {\n  const { urlList } = props\n  return urlList.length <= 1\n})\n\nconst isFirst = computed(() => {\n  return activeIndex.value === 0\n})\n\nconst isLast = computed(() => {\n  return activeIndex.value === props.urlList.length - 1\n})\n\nconst currentImg = computed(() => {\n  return props.urlList[activeIndex.value]\n})\n\nconst arrowPrevKls = computed(() => [\n  ns.e('btn'),\n  ns.e('prev'),\n  ns.is('disabled', !props.infinite && isFirst.value),\n])\n\nconst arrowNextKls = computed(() => [\n  ns.e('btn'),\n  ns.e('next'),\n  ns.is('disabled', !props.infinite && isLast.value),\n])\n\nconst imgStyle = computed(() => {\n  const { scale, deg, offsetX, offsetY, enableTransition } = transform.value\n  let translateX = offsetX / scale\n  let translateY = offsetY / scale\n\n  switch (deg % 360) {\n    case 90:\n    case -270:\n      ;[translateX, translateY] = [translateY, -translateX]\n      break\n    case 180:\n    case -180:\n      ;[translateX, translateY] = [-translateX, -translateY]\n      break\n    case 270:\n    case -90:\n      ;[translateX, translateY] = [-translateY, translateX]\n      break\n  }\n\n  const style: CSSProperties = {\n    transform: `scale(${scale}) rotate(${deg}deg) translate(${translateX}px, ${translateY}px)`,\n    transition: enableTransition ? 'transform .3s' : '',\n  }\n  if (mode.value.name === modes.CONTAIN.name) {\n    style.maxWidth = style.maxHeight = '100%'\n  }\n  return style\n})\n\nfunction hide() {\n  unregisterEventListener()\n  emit('close')\n}\n\nfunction registerEventListener() {\n  const keydownHandler = throttle((e: KeyboardEvent) => {\n    switch (e.code) {\n      // ESC\n      case EVENT_CODE.esc:\n        props.closeOnPressEscape && hide()\n        break\n      // SPACE\n      case EVENT_CODE.space:\n        toggleMode()\n        break\n      // LEFT_ARROW\n      case EVENT_CODE.left:\n        prev()\n        break\n      // UP_ARROW\n      case EVENT_CODE.up:\n        handleActions('zoomIn')\n        break\n      // RIGHT_ARROW\n      case EVENT_CODE.right:\n        next()\n        break\n      // DOWN_ARROW\n      case EVENT_CODE.down:\n        handleActions('zoomOut')\n        break\n    }\n  })\n  const mousewheelHandler = throttle((e: WheelEvent) => {\n    const delta = e.deltaY || e.deltaX\n    handleActions(delta < 0 ? 'zoomIn' : 'zoomOut', {\n      zoomRate: props.zoomRate,\n      enableTransition: false,\n    })\n  })\n\n  scopeEventListener.run(() => {\n    useEventListener(document, 'keydown', keydownHandler)\n    useEventListener(document, 'wheel', mousewheelHandler)\n  })\n}\n\nfunction unregisterEventListener() {\n  scopeEventListener.stop()\n}\n\nfunction handleImgLoad() {\n  loading.value = false\n}\n\nfunction handleImgError(e: Event) {\n  loading.value = false\n  ;(e.target as HTMLImageElement).alt = t('el.image.error')\n}\n\nfunction handleMouseDown(e: MouseEvent) {\n  if (loading.value || e.button !== 0 || !wrapper.value) return\n  transform.value.enableTransition = false\n\n  const { offsetX, offsetY } = transform.value\n  const startX = e.pageX\n  const startY = e.pageY\n\n  const dragHandler = throttle((ev: MouseEvent) => {\n    transform.value = {\n      ...transform.value,\n      offsetX: offsetX + ev.pageX - startX,\n      offsetY: offsetY + ev.pageY - startY,\n    }\n  })\n  const removeMousemove = useEventListener(document, 'mousemove', dragHandler)\n  useEventListener(document, 'mouseup', () => {\n    removeMousemove()\n  })\n\n  e.preventDefault()\n}\n\nfunction reset() {\n  transform.value = {\n    scale: 1,\n    deg: 0,\n    offsetX: 0,\n    offsetY: 0,\n    enableTransition: false,\n  }\n}\n\nfunction toggleMode() {\n  if (loading.value) return\n\n  const modeNames = keysOf(modes)\n  const modeValues = Object.values(modes)\n  const currentMode = mode.value.name\n  const index = modeValues.findIndex((i) => i.name === currentMode)\n  const nextIndex = (index + 1) % modeNames.length\n  mode.value = modes[modeNames[nextIndex]]\n  reset()\n}\n\nfunction setActiveItem(index: number) {\n  const len = props.urlList.length\n  activeIndex.value = (index + len) % len\n}\n\nfunction prev() {\n  if (isFirst.value && !props.infinite) return\n  setActiveItem(activeIndex.value - 1)\n}\n\nfunction next() {\n  if (isLast.value && !props.infinite) return\n  setActiveItem(activeIndex.value + 1)\n}\n\nfunction handleActions(action: ImageViewerAction, options = {}) {\n  if (loading.value) return\n  const { minScale, maxScale } = props\n  const { zoomRate, rotateDeg, enableTransition } = {\n    zoomRate: props.zoomRate,\n    rotateDeg: 90,\n    enableTransition: true,\n    ...options,\n  }\n  switch (action) {\n    case 'zoomOut':\n      if (transform.value.scale > minScale) {\n        transform.value.scale = Number.parseFloat(\n          (transform.value.scale / zoomRate).toFixed(3)\n        )\n      }\n      break\n    case 'zoomIn':\n      if (transform.value.scale < maxScale) {\n        transform.value.scale = Number.parseFloat(\n          (transform.value.scale * zoomRate).toFixed(3)\n        )\n      }\n      break\n    case 'clockwise':\n      transform.value.deg += rotateDeg\n      emit('rotate', transform.value.deg)\n      break\n    case 'anticlockwise':\n      transform.value.deg -= rotateDeg\n      emit('rotate', transform.value.deg)\n      break\n  }\n  transform.value.enableTransition = enableTransition\n}\n\nwatch(currentImg, () => {\n  nextTick(() => {\n    const $img = imgRefs.value[0]\n    if (!$img?.complete) {\n      loading.value = true\n    }\n  })\n})\n\nwatch(activeIndex, (val) => {\n  reset()\n  emit('switch', val)\n})\n\nonMounted(() => {\n  registerEventListener()\n  // add tabindex then wrapper can be focusable via Javascript\n  // focus wrapper so arrow key can't cause inner scroll behavior underneath\n  wrapper.value?.focus?.()\n})\n\ndefineExpose({\n  /**\n   * @description manually switch image\n   */\n  setActiveItem,\n})\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}